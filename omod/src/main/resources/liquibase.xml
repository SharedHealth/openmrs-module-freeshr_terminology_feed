<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="BD-201408041330" author="soham" context="setup">
        <comment>Added constraints to concept_reference_source table.</comment>
        <sql>
            ALTER TABLE concept_reference_source ADD UNIQUE (name);
        </sql>
    </changeSet>
    <changeSet id="BD-201411181657" author="neha" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from chunking_history;
            </sqlCheck>
        </preConditions>
        <comment>Add chunking history</comment>
        <sql>
            insert into chunking_history (id, chunk_length, start) values (1, 100, 1);
        </sql>
    </changeSet>
    <changeSet id="BD-201412011225" author="angshu" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_class where LOWER(name) = 'valueset';
            </sqlCheck>
        </preConditions>
        <comment>Add concept class valueset</comment>
        <sql>
            INSERT INTO concept_class (name, description, uuid, creator, date_created) values ('Valueset', 'FHIR valueset', uuid(), 1, NOW());
        </sql>
    </changeSet>

    <changeSet id="BD-201412031205" author="utsab" context="setup">
        <comment>Add concept procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031206" author="utsab" context="setup">
        <comment>Add concept answer procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptAnswerProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031207" author="utsab" context="setup">
        <comment>Add concept word procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptWordProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031208" author="utsab" context="setup">
        <comment>Set value as concept id procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/DeleteConceptProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031209" author="utsab" context="setup">
        <comment>Add concept description procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptDescriptionProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031210" author="utsab" context="setup">
        <comment>Add concept reference map procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptReferenceMapProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031211" author="utsab" context="setup">
        <comment>Add concept set members procedure</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptSetMembersProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031212" author="utsab" context="setup">
        <comment>Add concept numeric proc</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptNumericProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412041217" author="utsab" context="setup">
        <comment>Add concept event proc</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptEventsProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412041221" author="utsab" context="setup">
        <comment>Add concept reference event proc</comment>
        <sqlFile splitStatements="false" path="storedProcedures/AddConceptReferenceEventProc.sql"/>
    </changeSet>

    <changeSet id="BD-201412031409" author="utsab" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_source where name = 'ICD10-BD';
            </sqlCheck>
        </preConditions>
        <insert tableName="concept_reference_source">
            <column name="name" value="ICD10-BD"/>
            <column name="description" value="ICD10-BD"/>
            <column name="hl7_code" value="ICD10-BD"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueDate=" now()"/>
            <column name="uuid" valueComputed=" uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="BD-201412031412" author="utsab" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_source where name = 'SNOMED-BD';
            </sqlCheck>
        </preConditions>
        <insert tableName="concept_reference_source">
            <column name="name" value="SNOMED-BD"/>
            <column name="description" value="Systematized Nomenclature of Medicine Clinical Terms for Bangladesh"/>
            <column name="hl7_code" value="SNOMED-BD"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueDate=" now()"/>
            <column name="uuid" valueComputed=" uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="BD-201412031415" author="utsab" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_reference_source where name = 'LOINC';
            </sqlCheck>
        </preConditions>
        <insert tableName="concept_reference_source">
            <column name="name" value="LOINC"/>
            <column name="description" value="These are codes for tests"/>
            <column name="hl7_code" value="LOINC"/>
            <column name="creator" value="1"/>
            <column name="date_created" valueDate=" now()"/>
            <column name="uuid" valueComputed=" uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="BD-201412041450" author="utsab">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from concept_name where name = 'Death note';
            </sqlCheck>
        </preConditions>
        <sql>
            set @concept_id_death_note = 0;
            set @concept_name_short_id_death_note = 0;
            set @concept_name_full_id_death_note = 0;

            set @reference_term = '419620001';
            set @reference_name = 'Death Alert';


            set @concept_id_date_of_death = 0;
            set @concept_name_short_id_date_of_death = 0;
            set @concept_name_full_id_date_of_death = 0;

            set @concept_id_cause_of_death = 0;
            set @concept_name_short_id_cause_of_death = 0;
            set @concept_name_full_id_cause_of_death = 0;

            set @concept_id_Circumstances_of_death = 0;
            set @concept_name_short_id_circumstances_of_death = 0;
            set @concept_name_full_id_circumstances_of_death = 0;

            call add_concept(@concept_id_death_note, @concept_name_short_id_death_note, @concept_name_full_id_death_note,
            'Death Note', 'Death Note', 'N/A', 'ConvSet', true);

            select concept_source_id into @concept_source_id_for_SNOWMED from concept_reference_source where name = 'SNOMED-BD';
            select concept_map_type_id into @concept_map_type_id_for_SAMEAS from concept_map_type where name = 'SAME-AS';

            call add_concept_reference_map(@concept_id_death_note, @concept_source_id_for_SNOWMED, @reference_term, @reference_name,
            @concept_map_type_id_for_SAMEAS);

            select MAX(concept_reference_term_id) into @concept_reference_term_id from concept_reference_term;

            call add_concept(@concept_id_date_of_death, @concept_name_short_id_date_of_death, @concept_name_full_id_date_of_death,
            'Date of death', 'date of death', 'Date', 'Question', false);

            call add_concept(@concept_id_cause_of_death, @concept_name_short_id_cause_of_death, @concept_name_full_id_cause_of_death,
            'Cause of Death', 'Cause of Death', 'Coded', 'Misc', false);

            call add_concept(@concept_id_circumstances_of_death, @concept_name_short_id_circumstances_of_death,
            @concept_name_full_id_circumstances_of_death, 'Circumstances of Death', 'Death Circumstances', 'Text', 'Question', false);

            call add_concept_set_members(@concept_id_death_note, @concept_id_date_of_death, 1);
            call add_concept_set_members(@concept_id_death_note, @concept_id_cause_of_death, 2);
            call add_concept_set_members(@concept_id_death_note, @concept_id_circumstances_of_death, 3);

            call add_concept_word(@concept_id_death_note, @concept_name_short_id_death_note, 'DEATH', '1');
            call add_concept_word(@concept_id_death_note, @concept_name_full_id_death_note, 'NOTE', '1');

            call add_concept_word(@concept_id_date_of_death, @concept_name_short_id_cause_of_death, 'DATE', '1');
            call add_concept_word(@concept_id_date_of_death, @concept_name_full_id_date_of_death, 'DEATH', '1');

            call add_concept_word(@concept_id_cause_of_death, @concept_name_short_id_cause_of_death, 'CAUSE', '1');
            call add_concept_word(@concept_id_cause_of_death, @concept_name_full_id_cause_of_death, 'DEATH', '1');

            call add_concept_word(@concept_id_circumstances_of_death, @concept_name_short_id_circumstances_of_death, 'CIRCUMSTANCE', '1');
            call add_concept_word(@concept_id_circumstances_of_death, @concept_name_full_id_circumstances_of_death, 'DEATH', '1');

            call add_concept_reference_events(@concept_reference_term_id);
            call add_concept_events(@concept_id_death_note, 'ConvSet');
            call add_concept_events(@concept_id_date_of_death, 'Question');
            call add_concept_events(@concept_id_cause_of_death, 'Misc');
            call add_concept_events(@concept_id_circumstances_of_death, 'Question');
        </sql>
    </changeSet>

</databaseChangeLog>